"use strict";var Je=Object.create;var U=Object.defineProperty;var Xe=Object.getOwnPropertyDescriptor;var Ue=Object.getOwnPropertyNames;var Me=Object.getPrototypeOf,Ve=Object.prototype.hasOwnProperty;var Ke=(c,e)=>{for(var t in e)U(c,t,{get:e[t],enumerable:!0})},ce=(c,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ue(e))!Ve.call(c,r)&&r!==t&&U(c,r,{get:()=>e[r],enumerable:!(n=Xe(e,r))||n.enumerable});return c};var f=(c,e,t)=>(t=c!=null?Je(Me(c)):{},ce(e||!c||!c.__esModule?U(t,"default",{value:c,enumerable:!0}):t,c)),Qe=c=>ce(U({},"__esModule",{value:!0}),c);var at={};Ke(at,{BladeFormatter:()=>X,Formatter:()=>k});module.exports=Qe(at);var He=f(require("ignore")),I=f(require("path")),W=f(require("fs")),g=f(require("process")),$=f(require("chalk")),Ne=f(require("glob")),oe=f(require("util")),P=f(require("lodash")),le=f(require("find-config"));var R=f(require("js-beautify")),i=f(require("lodash")),it=f(require("vscode-textmate")),w=f(require("detect-indent")),De=f(require("aigle")),Fe=f(require("xregexp")),Y=require("@shufo/tailwindcss-class-sorter"),ae=require("html-attribute-sorter");var Ie=require("fs"),Re=f(require("lodash")),se=f(require("vscode-oniguruma")),Ee=f(require("path"));var S=f(require("lodash")),fe=f(require("fs")),ye=f(require("os")),K=f(require("chalk")),Q=f(require("prettier/standalone")),G=f(require("@prettier/plugin-php/standalone")),Ge=f(require("detect-indent"));var H=f(require("lodash")),T="@",C=["@alert","@pushonce","@push","@slot","@switch","@unless","@verbatim","@prependonce","@prepend","@once","@error","@empty","@guest","@isset","@permission","@permissions","@canany","@cannot","@can","@role","@hasrole","@hasanyrole","@hasallroles","@unlessrole","@hasexactroles","@if","@production","@env","@while","@auth","@forelse","@for","@foreach","@php","@component","@section","@customdirective"],he=H.default.map(C,c=>c.substring(1)),E=["@endalert","@endpushonce","@endpush","@endslot","@endswitch","@endunless","@endverbatim","@show","@stop","@endprependonce","@endprepend","@endonce","@enderror","@append","@overwrite","@endempty","@endguest","@endisset","@endpermission","@endpermissions","@endcanany","@endcannot","@endcan","@endrole","@endhasrole","@endhasanyrole","@endhasallroles","@endunlessrole","@endhasexactroles","@endif","@endproduction","@endenv","@endwhile","@endauth","@endforelse","@endforeach","@endfor","@endphp","@endcomponent","@endsection","@endcustomdirective"],L=["@elseenv","@elseif","@elsecanany","@elsecannot","@elsecan","@else","@elsecustomdirective"],te={"@section":2,"@push":2,"@prepend":2,"@slot":2},pe=["@forelse","@if"],ne=["@empty"],de=["@default"],O=["@forelse","@if","@for","@foreach","@while","@sectionmissing","@case"],M=["@endforelse","@endif","@endforeach","@endfor","@endwhile","@break"],re=["@button","@class","@include","@disabled","@checked","@json"],j=["@set","@json","@selected","@checked","@disabled","@php","@include","@includeif","@includewhen","@includeunless","@includefirst","@button","@class","@props","@aware"],ue=["@if","@while","@case","@isset","@empty","@elseif","@component","@hassection","@unless"],V=["@hassection"],me=["@charset","@color-profile","@counter-style","@font-face","@font-feature-values","@import","@keyframes","@media","@namespace","@page","@property","@supports"];function ge(c,e){return H.default.filter(c.tokens,t=>{let n=e.substring(t.startIndex,t.endIndex).trim();return H.default.includes(C,n)||H.default.includes(E,n)}).length>=2}var v="\\(((?:[^)(]+|\\((?:[^)(]+|\\((?:[^)(]+|\\((?:[^)(]+|\\([^)(]*\\))*\\))*\\))*\\))*)\\)?";var _=c=>{let e={get(){return null}};return S.default.isUndefined(c)||S.default.isNull(c)?e:c};async function Z(c){return new Promise((e,t)=>{fe.default.readFile(c,(n,r)=>n?t(n):e(r))})}function N(c){return c?c.split(/\r\n|\n|\r/):""}var F=1e3,_e={noPhpSyntaxCheck:!1,printWidth:F,trailingCommaPHP:!0,phpVersion:"8.1",singleQuote:!0};function D(c,e={}){let t={..._e,...e};try{return Q.default.format(c.replace(/\n$/,""),{parser:"php",printWidth:1e3,singleQuote:t.singleQuote,phpVersion:t.phpVersion,trailingCommaPHP:t.trailingCommaPHP,plugins:[G.default]})}catch(n){if(t.noPhpSyntaxCheck===!1)throw n;return c}}function B(c,e={}){let t={..._e,...e};try{return Q.default.format(`<?php echo ${c} ?>`,{parser:"php",printWidth:t.printWidth,singleQuote:t.singleQuote,phpVersion:t.phpVersion,trailingCommaPHP:t.trailingCommaPHP,plugins:[G.default]}).replace(/<\?php echo (.*)?\?>/gs,(n,r)=>r.trim().replace(/;\s*$/,""))}catch(n){if(t.noPhpSyntaxCheck===!1)throw n;return c}}function we(c){let e=`<?php tmp_func${c}; ?>`,{ast:t}=Q.default.__debug.parse(e,{parser:"php",phpVersion:"8.0",plugins:[G.default]});try{return t.children[0].expression.arguments.length||0}catch{return 0}}function Pe(c){return Promise.all(S.default.map(c,async e=>{process.stdout.write(`path: ${K.default.bold(e.path)}:${e.line}
`),process.stdout.write(K.default.red(`--${e.original}
`)),process.stdout.write(K.default.green(`++${e.formatted}
`))}))}function ve(c,e,t){let n=S.default.map(e,(r,s)=>S.default.isEmpty(r)||r===t[s]?null:{path:c,line:s+1,original:r,formatted:t[s]});return S.default.without(n,null)}async function Ze(c){let e=S.default.without(C,"@switch","@forelse","@php").join("|"),t=new RegExp(`(?!\\/\\*.*?\\*\\/)(${e})(\\s*?)${v}`,"gmi");return new Promise(n=>n(c)).then(n=>S.default.replace(n,t,(r,s,a,l)=>D(`<?php ${s.substr("1")}${a}(${l}) ?>`).replace(/<\?php\s(.*?)(\s*?)\((.*?)\);*\s\?>\n/gs,(o,h,d,p)=>`@${h.trim()}${d}(${p.trim()})`).replace(/([\n\s]*)->([\n\s]*)/gs,"->").replace(/,\)$/,")").replace(/(?:\n\s*)* as(?= (?:&{0,1}\$[\w]+|list|\[\$[\w]+))/g," as"))).then(n=>D(n))}async function $e(c){return Ze(c)}function be(c){let e=S.default.without(O,"@case"),t=S.default.without(M,"@break");return new Promise(n=>n(c)).then(n=>{let r=new RegExp(`(${e.join("|")})([\\s]*?)${v}`,"gis");return S.default.replace(n,r,(s,a,l,o)=>`<beautifyTag start="${a}${l}" exp="^^^${S.default.escape(o)}^^^">`)}).then(n=>{let r=new RegExp(`(?!end=".*)(${t.join("|")})(?!.*")`,"gi");return S.default.replace(n,r,(s,a)=>`</beautifyTag end="${a}">`)})}function Ce(c){return new Promise(e=>e(c)).then(e=>S.default.replace(e,/<beautifyTag.*?start="(.*?)".*?exp=".*?\^\^\^(.*?)\^\^\^.*?"\s*>/gs,(t,n,r)=>`${n}(${S.default.unescape(r)})`)).then(e=>S.default.replace(e,/<\/beautifyTag.*?end="(.*?)"\s*>/gs,(t,n)=>`${n}`))}var qe=["/\\*\\* phptag_start \\*\\*/","/\\*\\* end_phptag \\*\\*/","/\\*escaped\\*/","__BLADE__;","/\\* blade_comment_start \\*/","/\\* blade_comment_end \\*/","/\\*\\*\\*script_placeholder\\*\\*\\*/","beautifyTag","@customdirective","@elsecustomdirective","@endcustomdirective"];function Se(c){if(new RegExp(qe.join("|")).test(c))throw new Error(["Can't format blade: something goes wrong.","Please check if template is too complicated or not. Or simplify template might solves issue."].join(`
`));return c}function ie(c){return c.replace(/\$/g,"$$$$")}function xe(c){switch(c){case"LF":return`
`;case"CRLF":return`\r
`;default:return ye.default.EOL}}var q=class{constructor(e,t){return(async()=>{var n;return this.vsctm=(n=e.default)!=null?n:e,this.oniguruma=t||se.default||se,await this.loadWasm(),this})()}async loadWasm(){var t;let e=await Ie.promises.readFile(require.resolve("vscode-oniguruma/release/onig.wasm"));if(await((t=this.oniguruma)==null?void 0:t.loadWASM(e.buffer)),!this.initCalled){try{this.oniguruma.loadWASM(e.buffer)}catch{this.initCalled=!0}this.initCalled=!0}}createRegistry(){return this.registry=new this.vsctm.Registry({loadGrammar:e=>e==="text.html.php.blade"?Z(Ee.default.resolve(__dirname,"../syntaxes/blade.tmLanguage.json")).then(t=>this.vsctm.parseRawGrammar(t.toString(),"./blade.tmLanguage.json")):null,onigLib:Promise.resolve({createOnigScanner:e=>new this.oniguruma.OnigScanner(e),createOnigString:e=>new this.oniguruma.OnigString(e)})}),this.registry}tokenizeLines(e,t){return Re.default.map(e,n=>{var r;return t.tokenizeLine(n,(r=this.vsctm)==null?void 0:r.INITIAL)})}};function et(c){return c.split(`
`)}function tt(c){return c.trim().startsWith("*")}function nt(c){return c.length>1}function rt(c){return` ${c}`}function Le(c){let e=et(c);if(!nt(e))return c;let t=!1;return e.map((r,s)=>{if(s===0||t)return r;if(!tt(r))return t=!0,r;let a=r.trim();return rt(a)}).join(`
`)}var k=class{constructor(e){this.options={noPhpSyntaxCheck:!1,...e},this.vsctm=_(this.options).vsctm||it,this.oniguruma=_(this.options).oniguruma,this.indentCharacter=_(this.options).useTabs?"	":" ",this.indentSize=_(this.options).indentSize||4,this.wrapLineLength=_(this.options).wrapLineLength||120,this.wrapAttributes=_(this.options).wrapAttributes||"auto",this.currentIndentLevel=0,this.shouldBeIndent=!1,this.isInsideCommentBlock=!1,this.stack=[],this.ignoredLines=[],this.curlyBracesWithJSs=[],this.rawBlocks=[],this.rawPhpTags=[],this.inlineDirectives=[],this.conditions=[],this.inlinePhpDirectives=[],this.rawPropsBlocks=[],this.bladeDirectives=[],this.bladeComments=[],this.phpComments=[],this.bladeBraces=[],this.rawBladeBraces=[],this.nonnativeScripts=[],this.scripts=[],this.htmlAttributes=[],this.xData=[],this.xInit=[],this.htmlTags=[],this.templatingStrings=[],this.stringLiteralInPhp=[],this.shorthandBindings=[],this.componentAttributes=[],this.customDirectives=[],this.directivesInScript=[],this.unbalancedDirectives=[],this.escapedBladeDirectives=[],this.result=[],this.diffs=[],this.defaultPhpFormatOption={noPhpSyntaxCheck:this.options.noPhpSyntaxCheck,printWidth:this.wrapLineLength},this.endOfLine=xe(_(this.options).endOfLine)}formatContent(e){return new Promise(t=>t(e)).then(t=>this.preserveIgnoredLines(t)).then(t=>this.preserveNonnativeScripts(t)).then(t=>this.preserveCurlyBraceForJS(t)).then(t=>this.preserveRawPhpTags(t)).then(t=>this.preserveEscapedBladeDirective(t)).then(t=>$e(t)).then(t=>this.preserveBladeComment(t)).then(t=>this.preserveBladeBrace(t)).then(t=>this.preserveRawBladeBrace(t)).then(t=>this.preserveConditions(t)).then(t=>this.preserveInlineDirective(t)).then(t=>this.preserveInlinePhpDirective(t)).then(t=>this.preserveBladeDirectivesInScripts(t)).then(t=>this.preserveCustomDirective(t)).then(t=>this.preserveUnbalancedDirective(t)).then(t=>this.breakLineBeforeAndAfterDirective(t)).then(async t=>(this.bladeDirectives=await this.formatPreservedBladeDirectives(this.bladeDirectives),t)).then(t=>this.preserveScripts(t)).then(t=>this.sortTailwindcssClasses(t)).then(t=>this.formatXInit(t)).then(t=>this.formatXData(t)).then(t=>this.preserveComponentAttribute(t)).then(t=>this.preserveShorthandBinding(t)).then(t=>this.sortHtmlAttributes(t)).then(t=>this.preservePhpBlock(t)).then(t=>this.preserveHtmlAttributes(t)).then(t=>this.preserveHtmlTags(t)).then(t=>this.formatAsHtml(t)).then(t=>this.formatAsBlade(t)).then(t=>this.restoreHtmlTags(t)).then(t=>this.restoreHtmlAttributes(t)).then(t=>this.restorePhpBlock(t)).then(t=>this.restoreShorthandBinding(t)).then(t=>this.restoreComponentAttribute(t)).then(t=>this.restoreXData(t)).then(t=>this.restoreXInit(t)).then(t=>this.restoreScripts(t)).then(t=>this.restoreUnbalancedDirective(t)).then(t=>this.restoreCustomDirective(t)).then(t=>this.restoreBladeDirectivesInScripts(t)).then(t=>this.restoreInlinePhpDirective(t)).then(t=>this.restoreInlineDirective(t)).then(t=>this.restoreConditions(t)).then(t=>this.restoreRawBladeBrace(t)).then(t=>this.restoreBladeBrace(t)).then(t=>this.restoreBladeComment(t)).then(t=>this.restoreEscapedBladeDirective(t)).then(t=>this.restoreRawPhpTags(t)).then(t=>this.restoreCurlyBraceForJS(t)).then(t=>this.restoreNonnativeScripts(t)).then(t=>this.restoreIgnoredLines(t)).then(t=>Se(t))}formatAsHtml(e){let t={indent_size:_(this.options).indentSize||4,wrap_line_length:_(this.options).wrapLineLength||120,wrap_attributes:_(this.options).wrapAttributes||"auto",end_with_newline:_(this.options).endWithNewline||!0,max_preserve_newlines:_(this.options).noMultipleEmptyLines?1:void 0,css:{end_with_newline:!1},eol:this.endOfLine},n=new Promise(r=>r(e)).then(r=>be(r)).then(r=>R.default.html_beautify(r,t)).then(r=>Ce(r));return Promise.resolve(n)}async sortTailwindcssClasses(e){return this.options.sortTailwindcssClasses?i.default.replace(e,/(?<=\s+(?!:)class\s*=\s*([\"\']))(.*?)(?=\1)/gis,(t,n,r)=>{if(i.default.isEmpty(r))return r;if(this.options.tailwindcssConfigPath){let s={tailwindConfigPath:this.options.tailwindcssConfigPath};return(0,Y.sortClasses)(r,s)}if(this.options.tailwindcssConfig){let s={tailwindConfig:this.options.tailwindcssConfig};return(0,Y.sortClasses)(r,s)}return(0,Y.sortClasses)(r)}):e}async preserveIgnoredLines(e){return i.default.chain(e).replace(/(^(?<!.+)^{{--\s*blade-formatter-disable\s*--}}.*?)([\r\n]*)$(?![\r\n])/gis,(t,n,r)=>this.storeIgnoredLines(`${n}${r.replace(/^\n/,"")}`)).replace(/(?:({{--\s*?blade-formatter-disable\s*?--}}|<!--\s*?prettier-ignore-start\s*?-->|{{--\s*?prettier-ignore-start\s*?--}})).*?(?:({{--\s*?blade-formatter-enable\s*?--}}|<!--\s*?prettier-ignore-end\s*?-->|{{--\s*?prettier-ignore-end\s*?--}}))/gis,t=>this.storeIgnoredLines(t)).replace(/(?:{{--\s*?blade-formatter-disable-next-line\s*?--}}|{{--\s*?prettier-ignore\s*?--}}|<!--\s*?prettier-ignore\s*?-->)[\r\n]+[^\r\n]+/gis,t=>this.storeIgnoredLines(t)).value()}async preserveCurlyBraceForJS(e){return i.default.replace(e,/@{{(.*?)}}/gs,(t,n)=>this.storeCurlyBraceForJS(n))}async preservePhpBlock(e){return this.preserveRawPhpBlock(e)}async preservePropsBlock(e){return i.default.replace(e,/@props\(((?:[^\\(\\)]|\([^\\(\\)]*\))*)\)/gs,(t,n)=>this.storeRawPropsBlock(n))}async preserveRawPhpBlock(e){return i.default.replace(e,/(?<!@)@php(.*?)@endphp/gs,(t,n)=>this.storeRawBlock(n))}async preserveHtmlTags(e){let t=["textarea","pre"];return i.default.replace(e,new RegExp(`<(${t.join("|")})\\s{0,1}.*?>.*?<\\/(${t.join("|")})>`,"gis"),n=>this.storeHtmlTag(n))}preserveCustomDirective(e){let t=[...i.default.without(C,"@unless"),...E,...L,"@unless\\(.*?\\)"].join("|"),n=i.default.chain([...i.default.without(C,"@unless","@for"),...E,...L,...j,...i.default.without(O,"@for"),"@unless[a-z]*\\(.*?\\)","@for\\(.*?\\)",...V,...me]).uniq().join("|").value(),r=new RegExp(`(?!(${n}))(@([a-zA-Z1-9_\\-]+))(?!.*?@end\\3)${v}.*?(?<!@end\\5)`,"gis"),s=new RegExp(`(?!(${t}))(@(unless)*([a-zA-Z1-9_\\-]+))(?!.*?\\2)(\\s|\\(.*?\\))+(.*?)(@end\\4)`,"gis"),a;return a=i.default.replace(e,r,l=>this.storeInlineCustomDirective(l)),a=i.default.replace(a,s,(l,o,h,d,p,u,m,b)=>{if(C.includes(h))return l;let y=l;return y=i.default.replace(y,new RegExp(`${h}(${v})*`,"gim"),x=>this.storeBeginCustomDirective(x)),y=i.default.replace(y,b,this.storeEndCustomDirective(b)),y=i.default.replace(y,new RegExp(`@else${p}(${v})*`,"gim"),x=>this.storeElseCustomDirective(x)),y}),s.test(a)&&(a=this.preserveCustomDirective(a)),a}preserveInlineDirective(e){let t=new RegExp(`(<[\\w\\-\\_]+?[^>]*?)${T}(${he.join("|")})(\\s*?)?(\\([^)]*?\\))?((?:(?!@end\\2).)+)(@end\\2|@endif)(.*?/*>)`,"gims"),n=i.default.replace(e,t,(r,s,a,l,o,h,d,p)=>l===void 0&&o===void 0?`${s}${this.storeInlineDirective(`${T}${a.trim()}${h.trim()} ${d.trim()}`)}${p}`:l===void 0?`${s}${this.storeInlineDirective(`${T}${a.trim()}${o.trim()}${h}${d.trim()}`)}${p}`:o===void 0?`${s}${this.storeInlineDirective(`${T}${a.trim()}${l}${h.trim()} ${d.trim()}`)}${p}`:`${s}${this.storeInlineDirective(`${T}${a.trim()}${l}${o.trim()} ${h.trim()} ${d.trim()}`)}${p}`);return t.test(n)?this.preserveInlineDirective(n):n}async preserveInlinePhpDirective(e){return i.default.replace(e,new RegExp(`(?!\\/\\*.*?\\*\\/)(${j.join("|")})(\\s*?)${v}`,"gmsi"),t=>this.storeInlinePhpDirective(t))}preserveBladeDirectivesInScripts(e){return i.default.replace(e,/(?<=<script[^>]*?(?<!=)>)(.*?)(?=<\/script>)/gis,t=>{let n=[...C,...j];if(new RegExp(n.join("|"),"gmi").test(t)===!1)return/^[\s\n]+$/.test(t)?t.trim():t;let r=j.join("|"),s=new RegExp(`(?!\\/\\*.*?\\*\\/)(${r})(\\s*?)${v}`,"gmi"),a=i.default.chain(E).without("@endphp"),l=t;return l=i.default.replace(l,s,o=>this.storeBladeDirective(B(o,{...this.defaultPhpFormatOption,printWidth:F}))),l=i.default.replace(l,new RegExp(`(${C.join("|")})\\s*?${v}`,"gis"),o=>`if ( /*${this.storeBladeDirectiveInScript(o)}*/ ) {`),l=i.default.replace(l,new RegExp(`(${[...L,...ne].join("|")})(?!\\w+?\\s*?\\(.*?\\))`,"gis"),o=>`/***script_placeholder***/} /* ${this.storeBladeDirectiveInScript(o)} */ {`),l=i.default.replace(l,new RegExp(`(${a.join("|")})`,"gis"),o=>`/***script_placeholder***/} /*${this.storeBladeDirectiveInScript(o)}*/`),l=i.default.replace(l,/(?<!@)@php(.*?)@endphp/gis,(o,h)=>this.storeRawBlock(h)),l=this.preserveCustomDirectiveInScript(l),l})}preserveCustomDirectiveInScript(e){let t=[...i.default.without(C,"@unless"),...E,...L,"@unless\\(.*?\\)"].join("|"),n=[...i.default.without(C,"@unless"),...E,...L,...j,...O,"@unless[a-z]*\\(.*?\\)",...V].join("|"),r=new RegExp(`(?!(${n}))(@([a-zA-Z1-9_\\-]+))(?!.*?@end\\3)${v}.*?(?<!@end\\5)`,"gis"),s=new RegExp(`(?!(${t}))(@(unless)*([a-zA-Z1-9_\\-]+))(?!.*?\\2)(\\s|\\(.*?\\))+(.*?)(@end\\4)`,"gis"),a;return a=i.default.replace(e,r,l=>this.storeInlineCustomDirective(l)),a=i.default.replace(a,s,(l,o,h,d,p,u,m,b)=>{if(C.includes(h))return l;let y=l;return y=i.default.replace(y,new RegExp(`${h}(${v})*`,"gim"),x=>`if ( /*${this.storeBladeDirectiveInScript(x)}*/ ) {`),y=i.default.replace(y,new RegExp(`@else${p}(${v})*`,"gim"),x=>`/***script_placeholder***/} /* ${this.storeBladeDirectiveInScript(x)} */ {`),y=i.default.replace(y,b,x=>`/***script_placeholder***/} /*${this.storeBladeDirectiveInScript(x)}*/`),y}),s.test(a)&&(a=this.preserveCustomDirectiveInScript(a)),a}breakLineBeforeAndAfterDirective(e){e=i.default.replace(e,new RegExp(`(?<=<.*?(?<!=)>)(${i.default.without(C,"@php").join("|")})(\\s*)${v}.*?(?=<.*?>)`,"gmis"),s=>`
${s.trim()}
`),e=i.default.replace(e,new RegExp(`(?<=<.*?(?<!=)>).*?(${i.default.without(E,"@endphp").join("|")})(?=<.*?>)`,"gmis"),s=>`
${s.trim()}
`);let t=["@case",...L];e=i.default.replace(e,new RegExp(`(\\s*?)(${t.join("|")})(\\s*?)${v}(\\s*)`,"gmi"),s=>`
${s.trim()}
`),e=i.default.replace(e,new RegExp(`\\s*?(?!(${i.default.without(L,"@else").join("|")}))@else\\s+`,"gim"),s=>`
${s.trim()}
`),e=i.default.replace(e,/@case\S*?\s*?@case/gim,s=>`${s.replace(`
`,"")}`);let n=["@break"];i.default.forEach(n,s=>{e=i.default.replace(e,new RegExp(`(\\s*?)${s}\\s+`,"gmi"),a=>`
${a.trim()}

`)}),i.default.forEach(["@default"],s=>{e=i.default.replace(e,new RegExp(`(\\s*?)${s}\\s*`,"gmi"),a=>`

${a.trim()}
`)});let r=i.default.chain(C).map(s=>i.default.replace(s,/@/,"")).value();return i.default.forEach(r,s=>{try{let a=Fe.default.matchRecursive(e,`\\@${s}`,`\\@end${s}`,"gmi",{valueNames:[null,"left","match","right"]});if(i.default.isEmpty(a))return;for(let l of a)if(l.name==="match"){new RegExp(C.join("|")).test(l.value)&&(e=i.default.replace(e,l.value,this.breakLineBeforeAndAfterDirective(ie(l.value))));let o=new RegExp(`^(\\s*?)${v}(.*)`,"gmis"),h=i.default.replace(`${l.value}`,o,(d,p,u,m)=>m.trim()===""?`${p}(${u.trim()})
${m.trim()}`:`${p}(${u.trim()})
${m.trim()}
`);e=i.default.replace(e,l.value,ie(h))}}catch{}}),e}async preserveEscapedBladeDirective(e){return i.default.replace(e,/@@\w*/gim,t=>this.storeEscapedBladeDirective(t))}async preserveBladeComment(e){return i.default.replace(e,/\{\{--(.*?)--\}\}/gs,t=>this.storeBladeComment(t))}preservePhpComment(e){return i.default.replace(e,/\/\*(?:[^*]|[\r\n]|(?:\*+(?:[^*\/]|[\r\n])))*\*+\//gi,t=>this.storePhpComment(t))}async preserveBladeBrace(e){return i.default.replace(e,/\{\{(.*?)\}\}/gs,(t,n)=>n===""?this.storeBladeBrace(n,n.length):/\S/.test(n)?this.storeBladeBrace(n.trim(),n.trim().length):this.storeBladeBrace(" ",1))}async preserveRawBladeBrace(e){return i.default.replace(e,/\{!!(.*?)!!\}/gs,(t,n)=>n===""?this.storeRawBladeBrace(n):/\S/.test(n)?this.storeRawBladeBrace(n.trim()):this.storeRawBladeBrace(" "))}async preserveConditions(e){let t=new RegExp(`(${ue.join("|")})(\\s*?)${v}`,"gi");return i.default.replace(e,t,(n,r,s,a)=>`${r}${s}(${this.storeConditions(a)})`)}preserveUnbalancedDirective(e){let t=new RegExp(`((${V.join("|")})(?!.*?\\2)(?:\\s|\\(.*?\\)))+(?=.*?@endif)`,"gis"),n=i.default.replace(e,t,(r,s)=>`${this.storeUnbalancedDirective(s)}`);return t.test(n)&&(n=this.preserveUnbalancedDirective(n)),n}async preserveRawPhpTags(e){return i.default.replace(e,/<\?php(.*?)\?>/gms,t=>this.storeRawPhpTags(t))}async preserveNonnativeScripts(e){return i.default.replace(e,/<script[^>]*?type=(["'])(?!text\/javascript)[^\1]*?\1[^>]*?>.*?<\/script>/gis,t=>this.storeNonnativeScripts(t))}async preserveScripts(e){return i.default.replace(e,/<script.*?>.*?<\/script>/gis,t=>this.storeScripts(t))}async preserveHtmlAttributes(e){return i.default.replace(e,/(?<=<[\w]*?[\s].*?)[\w\-\_\:]+?=(["']).*?(?<!\\)\1(?=.*?(?<!=)>)/gms,t=>`${this.storeHtmlAttribute(t)}`)}async sortHtmlAttributes(e){var n;let t=(n=this.options.sortHtmlAttributes)!=null?n:"none";if(!i.default.isEmpty(t)&&t!=="none"){let r=this.options.customHtmlAttributesOrder;if(i.default.isArray(r))return(0,ae.sortAttributes)(e,{order:t,customRegexes:r});let s=i.default.chain(r).split(",").map(i.default.trim).value();return(0,ae.sortAttributes)(e,{order:t,customRegexes:s})}return e}async preserveShorthandBinding(e){return i.default.replace(e,/(?<=<(?!livewire:)[^<]*?(\s|x-bind)):{1}(?<!=>)[\w\-_.]*?=(["'])(?!=>)[^]*?\2(?=[^>]*?\/*?>)/gim,t=>`${this.storeShorthandBinding(t)}`)}async preserveComponentAttribute(e){return i.default.replace(e,/(?<=<(x-|livewire:)[^<]*?\s):{1,2}(?<!=>)[\w\-_.]*?=(["'])(?!=>)[^]*?\2(?=[^>]*?\/*?>)/gim,t=>`${this.storeComponentAttribute(t)}`)}async formatXData(e){return i.default.replace(e,/(\s*)x-data="(.*?)"(\s*)/gs,(t,n,r,s)=>`${n}x-data="${this.storeXData(r)}"${s}`)}async formatXInit(e){return i.default.replace(e,/(\s*)x-init="(.*?)"(\s*)/gs,(t,n,r,s)=>`${n}x-init="${this.storeXInit(r)}"${s}`)}preserveStringLiteralInPhp(e){return i.default.replace(e,/(\"([^\\]|\\.)*?\"|\'([^\\]|\\.)*?\')/gm,t=>`${this.storeStringLiteralInPhp(t)}`)}storeIgnoredLines(e){return this.getIgnoredLinePlaceholder(this.ignoredLines.push(e)-1)}storeCurlyBraceForJS(e){return this.getCurlyBraceForJSPlaceholder(this.curlyBracesWithJSs.push(e)-1)}storeRawBlock(e){return this.getRawPlaceholder(this.rawBlocks.push(e)-1)}storeInlineDirective(e){return this.getInlinePlaceholder(this.inlineDirectives.push(e)-1,e.length)}storeConditions(e){return this.getConditionPlaceholder(this.conditions.push(e)-1)}storeInlinePhpDirective(e){return this.getInlinePhpPlaceholder(this.inlinePhpDirectives.push(e)-1)}storeRawPropsBlock(e){return this.getRawPropsPlaceholder(this.rawPropsBlocks.push(e)-1)}storeBladeDirective(e){return this.getBladeDirectivePlaceholder(this.bladeDirectives.push(e)-1)}storeEscapedBladeDirective(e){return this.getEscapedBladeDirectivePlaceholder((this.escapedBladeDirectives.push(e)-1).toString())}storeBladeComment(e){return this.getBladeCommentPlaceholder(this.bladeComments.push(e)-1)}storePhpComment(e){return this.getPhpCommentPlaceholder((this.phpComments.push(e)-1).toString())}storeHtmlTag(e){return this.getHtmlTagPlaceholder((this.htmlTags.push(e)-1).toString())}storeInlineCustomDirective(e){return this.getInlineCustomDirectivePlaceholder((this.customDirectives.push(e)-1).toString())}storeBeginCustomDirective(e){return this.getBeginCustomDirectivePlaceholder((this.customDirectives.push(e)-1).toString())}storeElseCustomDirective(e){return this.getElseCustomDirectivePlaceholder((this.customDirectives.push(e)-1).toString())}storeEndCustomDirective(e){return this.getEndCustomDirectivePlaceholder((this.customDirectives.push(e)-1).toString())}storeUnbalancedDirective(e){return this.getUnbalancedDirectivePlaceholder((this.unbalancedDirectives.push(e)-1).toString())}storeBladeBrace(e,t){let n=this.bladeBraces.push(e)-1,r="{{  }}";return this.getBladeBracePlaceholder(n,t+r.length)}storeRawBladeBrace(e){let t=this.rawBladeBraces.push(e)-1;return this.getRawBladeBracePlaceholder(t)}storeRawPhpTags(e){let t=this.rawPhpTags.push(e)-1;return this.getRawPhpTagPlaceholder(t)}storeNonnativeScripts(e){let t=this.nonnativeScripts.push(e)-1;return this.getNonnativeScriptPlaceholder(t.toString())}storeScripts(e){let t=this.scripts.push(e)-1;return this.getScriptPlaceholder(t)}storeHtmlAttribute(e){let t=this.htmlAttributes.push(e)-1;return e.length>0?this.getHtmlAttributePlaceholder(t.toString(),e.length):this.getHtmlAttributePlaceholder(t.toString(),0)}storeShorthandBinding(e){let t=this.shorthandBindings.push(e)-1;return this.getShorthandBindingPlaceholder(t.toString(),e.length)}storeComponentAttribute(e){let t=this.componentAttributes.push(e)-1;return this.getComponentAttributePlaceholder(t.toString())}storeXData(e){let t=this.xData.push(e)-1;return this.getXDataPlaceholder(t)}storeXInit(e){let t=this.xInit.push(e)-1;return this.getXInitPlaceholder(t)}storeTemplatingString(e){let t=this.templatingStrings.push(e)-1;return this.getTemplatingStringPlaceholder(t)}storeStringLiteralInPhp(e){let t=this.stringLiteralInPhp.push(e)-1;return this.getStringLiteralInPhpPlaceholder(t)}storeBladeDirectiveInScript(e){return this.getBladeDirectiveInScriptPlaceholder((this.directivesInScript.push(e)-1).toString())}getIgnoredLinePlaceholder(e){return i.default.replace("___ignored_line_#___","#",e)}getCurlyBraceForJSPlaceholder(e){return i.default.replace("___js_curly_brace_#___","#",e)}getRawPlaceholder(e){return i.default.replace("___raw_block_#___","#",e)}getInlinePlaceholder(e,t=0){if(t>0){let r=t-"___inline_directive_#___".length;return i.default.replace(`___inline_directive_${i.default.repeat("_",r>0?r:0)}#___`,"#",e)}return i.default.replace("___inline_directive_+?#___","#",e)}getConditionPlaceholder(e){return i.default.replace("___directive_condition_#___","#",e)}getInlinePhpPlaceholder(e){return i.default.replace("___inline_php_directive_#___","#",e)}getRawPropsPlaceholder(e){return i.default.replace("@__raw_props_block_#__@","#",e)}getBladeDirectivePlaceholder(e){return i.default.replace("___blade_directive_#___","#",e)}getEscapedBladeDirectivePlaceholder(e){return i.default.replace("___escaped_directive_#___","#",e)}getBladeCommentPlaceholder(e){return i.default.replace("___blade_comment_#___","#",e)}getPhpCommentPlaceholder(e){return i.default.replace("___php_comment_#___","#",e)}getBladeBracePlaceholder(e,t=0){if(t>0){let r=t-"___blade_brace_#___".length;return i.default.replace(`___blade_brace_${i.default.repeat("_",r>0?r:0)}#___`,"#",e)}return i.default.replace("___blade_brace_+?#___","#",e)}getRawBladeBracePlaceholder(e){return i.default.replace("___raw_blade_brace_#___","#",e)}getRawPhpTagPlaceholder(e){return i.default.replace("___raw_php_tag_#___","#",e)}getNonnativeScriptPlaceholder(e){return i.default.replace("<blade ___non_native_scripts_#___ />","#",e)}getScriptPlaceholder(e){return i.default.replace("<blade ___scripts_#___ />","#",e)}getHtmlTagPlaceholder(e){return i.default.replace("<blade ___html_tags_#___ />","#",e)}getInlineCustomDirectivePlaceholder(e){return i.default.replace("___inline_cd_#___","#",e)}getBeginCustomDirectivePlaceholder(e){return i.default.replace("@customdirective(___#___)","#",e)}getElseCustomDirectivePlaceholder(e){return i.default.replace("@else(___#___)","#",e)}getEndCustomDirectivePlaceholder(e){return i.default.replace("@endcustomdirective(___#___)","#",e)}getUnbalancedDirectivePlaceholder(e){return i.default.replace("@if (unbalanced___#___)","#",e)}getHtmlAttributePlaceholder(e,t){if(t&&t>0){let r=t-"___attrs_#___".length;return i.default.replace(`___attrs${i.default.repeat("_",r>0?r:1)}#___`,"#",e)}return i.default.isNull(t)?i.default.replace("___attrs_#___","#",e):i.default.replace("___attrs_+?#___","#",e)}getShorthandBindingPlaceholder(e,t=0){if(t&&t>0){let r=t-"___short_binding_#___".length;return i.default.replace(`___short_binding_${i.default.repeat("_",r>0?r:1)}#___`,"#",e)}return i.default.replace("___short_binding_+?#___","#",e)}getComponentAttributePlaceholder(e){return i.default.replace("___attribute_#___","#",e)}getXInitPlaceholder(e){return i.default.replace("___x_init_#___","#",e)}getPlaceholder(e,t,n=null){if(n&&n>0){let r=`___${e}_#___`,s=n-r.length;return i.default.replace(`___${e}${i.default.repeat("_",s>0?s:1)}#___`,"#",t)}return i.default.isNull(n)?i.default.replace(`___${e}_#___`,"#",t):i.default.replace(`s___${e}_+?#___`,"#",t)}getXDataPlaceholder(e){return i.default.replace("___x_data_#___","#",e)}getTemplatingStringPlaceholder(e){return i.default.replace("___templating_str_#___","#",e)}getStringLiteralInPhpPlaceholder(e){return i.default.replace("'___php_content_#___'","#",e)}getBladeDirectiveInScriptPlaceholder(e){return i.default.replace("___directives_script_#___","#",e)}restoreIgnoredLines(e){return i.default.replace(e,new RegExp(`${this.getIgnoredLinePlaceholder("(\\d+)")}`,"gm"),(t,n)=>this.ignoredLines[n])}restoreCurlyBraceForJS(e){return i.default.replace(e,new RegExp(`${this.getCurlyBraceForJSPlaceholder("(\\d+)")}`,"gm"),(t,n)=>`@{{ ${R.default.js_beautify(this.curlyBracesWithJSs[n].trim())} }}`)}restorePhpBlock(e){return this.restoreRawPhpBlock(e).then(t=>this.restoreRawPropsBlock(t))}async restoreRawPhpBlock(e){return i.default.replace(e,new RegExp(`${this.getRawPlaceholder("(\\d+)")}`,"gm"),(t,n)=>{var o;let r=this.rawBlocks[n],s=this.getRawPlaceholder(n.toString()),a=(o=e.match(new RegExp(`^(.*?)${s}`,"gmi")))!=null?o:[""],l=(0,w.default)(a[0]);return this.isInline(r)&&this.isMultilineStatement(r)?r=D(`<?php
${r}
?>`,this.defaultPhpFormatOption).trim():r.split(`
`).length>1?r=D(`<?php${r}?>`,this.defaultPhpFormatOption).trimRight(`
`):r=`<?php${r}?>`,i.default.replace(r,/^(\s*)?<\?php(.*?)\?>/gms,(h,d,p)=>{if(this.isInline(r))return`@php${p}@endphp`;let u=this.preserveStringLiteralInPhp(p);u=this.preservePhpComment(u);let m=this.indentRawBlock(l,u);return m=this.restorePhpComment(m),`@php${this.restoreStringLiteralInPhp(m)}@endphp`})})}async restoreRawPropsBlock(e){let t=this.getRawPropsPlaceholder("(\\d+)");return i.default.replace(e,new RegExp(t,"gms"),(n,r)=>`@props(${B(this.rawPropsBlocks[r],{...this.defaultPhpFormatOption,printWidth:F}).trimRight()})`)}isInline(e){return i.default.split(e,`
`).length===1}isMultilineStatement(e){return D(`<?php${e}?>`,this.defaultPhpFormatOption).trimRight().split(`
`).length>1}indentRawBlock(e,t){if(this.isInline(t))return`${e.indent}${t}`;let r=e.amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:(r+1)*this.indentSize),a=this.indentCharacter.repeat(r<0?0:r*this.indentSize),l=t.split(`
`);return i.default.chain(l).map((o,h)=>h===0?o.trim():h===l.length-1?a+o:s+o).join(`
`).value()}indentBladeDirectiveBlock(e,t){if(i.default.isEmpty(e.indent))return t;if(this.isInline(t))return`${e.indent}${t}`;let r=e.amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:r*this.indentSize),a=this.indentCharacter.repeat(r<0?0:r*this.indentSize),l=t.split(`
`);return i.default.chain(l).map((o,h)=>h===l.length-1?a+o:s+o).value().join(`
`)}indentScriptBlock(e,t){if(i.default.isEmpty(e.indent))return t;if(this.isInline(t))return`${t}`;let r=e.amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:r*this.indentSize),a=this.indentCharacter.repeat(r<0?0:r*this.indentSize),o=i.default.replace(t,/`.*?`/gs,d=>this.storeTemplatingString(d)).split(`
`),h=i.default.chain(o).map((d,p)=>p===0?d:p===o.length-1?a+d:i.default.isEmpty(d)?d:s+d).value().join(`
`);return this.restoreTemplatingString(`${h}`)}indentRawPhpBlock(e,t){if(i.default.isEmpty(e.indent))return t;if(this.isInline(t))return`${t}`;let r=e.amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:r*this.indentSize),a=t.split(`
`);return i.default.chain(a).map((l,o)=>o===0?l.trim():s+l).value().join(`
`)}indentComponentAttribute(e,t){if(i.default.isEmpty(e))return t;if(this.isInline(t))return`${t}`;if(this.isInline(t)&&/\S/.test(e))return`${t}`;let r=(0,w.default)(e).amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:r*this.indentSize),a=t.split(`
`);return i.default.chain(a).map((l,o)=>o===0?l.trim():s+l).value().join(`
`)}indentPhpComment(e,t){if(i.default.isEmpty(e.indent))return t;if(this.isInline(t))return`${t}`;let r=e.amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:r*this.indentSize),a=t.split(`
`),l=!1;return i.default.chain(a).map((o,h)=>h===0?o.trim():o.trim().startsWith("*")?o.trim().endsWith("*/")&&l?o:s+o:(l=!0,o)).join(`
`).value()}restoreBladeDirectivesInScripts(e){let t=new RegExp(`${this.getBladeDirectivePlaceholder("(\\d+)")}`,"gm"),n=i.default.replace(e,t,(r,s)=>{var h;let a=this.getBladeDirectivePlaceholder(s.toString()),l=(h=e.match(new RegExp(`^(.*?)${a}`,"gmi")))!=null?h:[""],o=(0,w.default)(l[0]);return this.indentBladeDirectiveBlock(o,this.bladeDirectives[s])});return n=i.default.replace(n,/(?<=<script[^>]*?(?<!=)>)(.*?)(?=<\/script>)/gis,r=>{let s=r;return s=i.default.replace(s,new RegExp(`if \\( \\/\\*(?:(?:${this.getBladeDirectiveInScriptPlaceholder("(\\d+)")}).*?)\\*\\/ \\) \\{`,"gis"),(a,l)=>`${this.directivesInScript[l]}`),s=i.default.replace(s,new RegExp(`} \\/\\* (?:${this.getBladeDirectiveInScriptPlaceholder("(\\d+)")}) \\*\\/ {(\\s*?\\(___directive_condition_\\d+___\\))?`,"gim"),(a,l,o)=>i.default.isUndefined(o)?`${this.directivesInScript[l].trim()}`:`${this.directivesInScript[l].trim()} ${(o!=null?o:"").trim()}`),s=i.default.replace(s,new RegExp(`} \\/\\*(?:${this.getBladeDirectiveInScriptPlaceholder("(\\d+)")})\\*\\/`,"gis"),(a,l)=>`${this.directivesInScript[l]}`),s=i.default.replace(s,new RegExp(`${this.getRawPlaceholder("(\\d+)")}`,"gm"),(a,l)=>{var u;let o=this.rawBlocks[l],h=this.getRawPlaceholder(l.toString()),d=(u=e.match(new RegExp(`^(.*?)${h}`,"gmi")))!=null?u:[""],p=(0,w.default)(d[0]);return this.isInline(o)&&this.isMultilineStatement(o)?o=D(`<?php
${o}
?>`,this.defaultPhpFormatOption).trim():o.split(`
`).length>1?o=D(`<?php${o}?>`,this.defaultPhpFormatOption).trim():o=`<?php${o}?>`,i.default.replace(o,/^(\s*)?<\?php(.*?)\?>/gms,(m,b,y)=>{if(this.isInline(o))return`@php${y}@endphp`;let x=this.preserveStringLiteralInPhp(y),A=this.indentRawBlock(p,x);return`@php${this.restoreStringLiteralInPhp(A)}@endphp`})}),s=i.default.replace(s,/(?<=[\S]+)\s*?\/\*\*\*script_placeholder\*\*\*\/(\s)/gim,(a,l)=>l),s}),t.test(n)&&(n=this.restoreBladeDirectivesInScripts(n)),n}async formatPreservedBladeDirectives(e){return De.default.map(e,async t=>{let n=await this.formatAsHtml(t);return(await this.formatAsBlade(n)).trimRight(`
`)})}restoreBladeComment(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getBladeCommentPlaceholder("(\\d+)")}`,"gms"),(n,r)=>this.bladeComments[r].replace(/{{--(?=\S)/g,"{{-- ").replace(/(?<=\S)--}}/g," --}}")))}restorePhpComment(e){return i.default.replace(e,new RegExp(`${this.getPhpCommentPlaceholder("(\\d+)")};{0,1}`,"gms"),(t,n)=>{var o;let r=this.getPhpCommentPlaceholder(n.toString()),s=(o=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?o:[""],a=(0,w.default)(s[0]),l=Le(this.phpComments[n]);return this.indentPhpComment(a,l)})}async restoreEscapedBladeDirective(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getEscapedBladeDirectivePlaceholder("(\\d+)")}`,"gms"),(n,r)=>this.escapedBladeDirectives[r]))}restoreBladeBrace(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getBladeBracePlaceholder("(\\d+)")}`,"gm"),(n,r)=>{var h;let s=this.getBladeBracePlaceholder(r.toString()),a=(h=e.match(new RegExp(`^(.*?)${s}`,"gmi")))!=null?h:[""],l=(0,w.default)(a[0]),o=this.bladeBraces[r];return o.trim()===""?`{{${o}}}`:this.isInline(o)?`{{ ${B(o,{...this.defaultPhpFormatOption,trailingCommaPHP:!1,printWidth:F}).replace(/([\n\s]*)->([\n\s]*)/gs,"->").split(`
`).map(d=>d.trim()).join("").trimRight(`
`)} }}`:`{{ ${this.indentRawPhpBlock(l,B(o,this.defaultPhpFormatOption).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().trimRight(`
`))} }}`}))}restoreRawBladeBrace(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getRawBladeBracePlaceholder("(\\d+)")}`,"gms"),(n,r)=>{var h;let s=this.getRawBladeBracePlaceholder(r),a=(h=e.match(new RegExp(`^(.*?)${s}`,"gmi")))!=null?h:[""],l=(0,w.default)(a[0]),o=this.rawBladeBraces[r];return o.trim()===""?`{!!${o}!!}`:this.indentRawPhpBlock(l,`{!! ${B(o,this.defaultPhpFormatOption).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim()} !!}`)}))}restoreInlineDirective(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getInlinePlaceholder("(\\d+)")}`,"gms"),(n,r)=>this.inlineDirectives[r]))}restoreConditions(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getConditionPlaceholder("(\\d+)")}`,"gms"),(n,r)=>{var h;let s=this.getConditionPlaceholder(r),a=(h=e.match(new RegExp(`^(.*?)${s}`,"gmi")))!=null?h:[""],l=(0,w.default)(a[0]),o=this.conditions[r];return this.indentComponentAttribute(l.indent,B(o,this.defaultPhpFormatOption).replace(/([\n\s]*)->([\n\s]*)/gs,"->").replace(/(?<!(['"]).*)(?<=\()[\n\s]+?(?=\w)/gms,"").replace(/,[\n\s]*?\)/gs,")").trimEnd())}))}restoreUnbalancedDirective(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,/@if \(unbalanced___(\d+)___\)/gms,(n,r)=>this.unbalancedDirectives[r]))}restoreInlinePhpDirective(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getInlinePhpPlaceholder("(\\d+)")}`,"gm"),(n,r)=>{var h;let s=this.inlinePhpDirectives[r],a=this.getInlinePhpPlaceholder(r),l=(h=e.match(new RegExp(`^(.*?)${a}`,"gmi")))!=null?h:[""],o=(0,w.default)(l[0]);return s.includes("@php")?`${B(s,{...this.defaultPhpFormatOption,printWidth:F}).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().trimRight(`
`)}`:new RegExp(re.join("|"),"gi").test(s)?i.default.replace(s,new RegExp(`(?<=@(${i.default.map(re,p=>p.substring(1)).join("|")}).*?\\()(.*)(?=\\))`,"gis"),(p,u,m)=>{let b=this.wrapLineLength;["button","class"].includes(u)&&(b=80),u==="include"&&(b=this.wrapLineLength-4-r.length-o.amount);let y=`func(${m})`,x=B(y,{...this.defaultPhpFormatOption,printWidth:b});if(x===y)return m;let A=x.replace(/([\n\s]*)->([\n\s]*)/gs,"->").replace(/,(\s*?\))/gis,(ee,z)=>z).trim();return this.options.useTabs&&(A=i.default.replace(A,/(?<=^ *) {4}/gm,"	".repeat(this.indentSize))),this.isInline(A)?`${this.indentRawPhpBlock(o,`${A}`).replace(/func\((.*)\)/gis,(ee,z)=>z).trim()}`:this.indentRawPhpBlock(o,`${A}`).replace(/func\((.*)\)/gis,(ee,z)=>z).trim()}):`${B(s,{...this.defaultPhpFormatOption,printWidth:F}).trimEnd()}`}))}restoreRawPhpTags(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getRawPhpTagPlaceholder("(\\d+)")}`,"gms"),(n,r)=>{var s;try{let a=this.rawPhpTags[r],o=/(?<=<\?php\s*?)\/\*.*?\*\/(?=\s*?\?>)/gim.test(a)&&this.isInline(a),h=this.getRawPhpTagPlaceholder(r),d=(s=e.match(new RegExp(`^(.*?)${h}`,"gmi")))!=null?s:[""],p=(0,w.default)(d[0]);if(o)return a;let u=D(this.rawPhpTags[r],this.defaultPhpFormatOption).trim().trimRight(`
`);if(this.isInline(u))return u;let m=this.preservePhpComment(u);return p.indent&&(m=this.indentRawPhpBlock(p,m)),this.restorePhpComment(m)}catch{return`${this.rawPhpTags[r]}`}}))}restoreNonnativeScripts(e){return i.default.replace(e,new RegExp(`${this.getNonnativeScriptPlaceholder("(\\d+)")}`,"gmi"),(t,n)=>`${this.nonnativeScripts[n]}`)}restoreScripts(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getScriptPlaceholder("(\\d+)")}`,"gim"),(n,r)=>{var p;let s=this.scripts[r],a=this.getScriptPlaceholder(r),l=(p=e.match(new RegExp(`^(.*?)${a}`,"gmi")))!=null?p:[""],o=(0,w.default)(l[0]),h=_(this.options).useTabs||!1,d={indent_size:_(this.options).indentSize||4,wrap_line_length:_(this.options).wrapLineLength||120,wrap_attributes:_(this.options).wrapAttributes||"auto",indent_with_tabs:h,end_with_newline:!1,templating:["php"]};return h?this.indentScriptBlock(o,i.default.replace(R.default.html_beautify(s,d),/\t/g,"	".repeat(this.indentSize))):this.indentScriptBlock(o,R.default.html_beautify(s,d))}))}async restoreCustomDirective(e){return this.restoreInlineCustomDirective(e).then(t=>this.restoreBeginCustomDirective(t)).then(t=>this.restoreElseCustomDirective(t)).then(t=>this.restoreEndCustomDirective(t))}async restoreInlineCustomDirective(e){return i.default.replace(e,new RegExp(`${this.getInlineCustomDirectivePlaceholder("(\\d+)")}`,"gim"),(t,n)=>{var o;let r=this.getInlineCustomDirectivePlaceholder(n.toString()),s=(o=e.match(new RegExp(`^(.*?)${i.default.escapeRegExp(r)}`,"gmi")))!=null?o:[""],a=(0,w.default)(s[0]),l=`${this.customDirectives[n]}`;return i.default.replace(l,/(@[a-zA-z0-9\-_]+)(.*)/gis,(h,d,p)=>{try{let u=B(`func${p}`,{...this.defaultPhpFormatOption,printWidth:F}).replace(/([\n\s]*)->([\n\s]*)/gs,"->").replace(/,(\s*?\))$/gm,(m,b)=>b).trim().substring(4);return`${d}${this.indentComponentAttribute(a.indent,u)}`}catch{return`${h}`}})})}async restoreBeginCustomDirective(e){return i.default.replace(e,new RegExp(`@customdirective\\(___(\\d+)___\\)\\s*?(${v})*`,"gim"),(t,n)=>{var o;let r=this.getBeginCustomDirectivePlaceholder(n.toString()),s=(o=e.match(new RegExp(`^(.*?)${i.default.escapeRegExp(r)}`,"gmi")))!=null?o:[""],a=(0,w.default)(s[0]),l=`${this.customDirectives[n]}`;return i.default.replace(l,/(@[a-zA-z0-9\-_]+)(.*)/gis,(h,d,p)=>{try{let u=B(`func${p}`,{...this.defaultPhpFormatOption,trailingCommaPHP:!1}).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().substring(4);return`${d}${this.indentComponentAttribute(a.indent,u)}`}catch{return`${h}`}})})}async restoreElseCustomDirective(e){return i.default.replace(e,/@else\(___(\d+)___\)/gim,(t,n)=>`${this.customDirectives[n]}`)}async restoreEndCustomDirective(e){return i.default.replace(e,/@endcustomdirective\(___(\d+)___\)/gim,(t,n)=>`${this.customDirectives[n]}`)}async restoreHtmlTags(e){return i.default.replace(e,new RegExp(`${this.getHtmlTagPlaceholder("(\\d+)")}`,"gim"),(t,n)=>{var p;let r=this.getHtmlTagPlaceholder(n.toString()),s=(p=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?p:[""],a=(0,w.default)(s[0]),l={indent_size:_(this.options).indentSize||4,wrap_line_length:_(this.options).wrapLineLength||120,wrap_attributes:_(this.options).wrapAttributes||"auto",end_with_newline:!1,templating:["php"]},o=this.htmlTags[n],h=i.default.first(o.match(/(<(textarea|pre).*?(?<!=)>)(?=.*?<\/\2>)/gis));if(h===void 0)return`${this.indentScriptBlock(a,R.default.html_beautify(o,l))}`;let d=o.substring(h.length,o.length);return`${this.indentScriptBlock(a,R.default.html_beautify(h,l))}${d}`})}restoreHtmlAttributes(e){return i.default.replace(e,new RegExp(`${this.getHtmlAttributePlaceholder("(\\d+)")}`,"gms"),(t,n)=>this.htmlAttributes[n])}restoreXData(e){return i.default.replace(e,new RegExp(`${this.getXDataPlaceholder("(\\d+)")}`,"gm"),(t,n)=>{var u;let r=this.getXDataPlaceholder(n.toString()),s=(u=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?u:[""],a=(0,w.default)(s[0]),l=this.formatJS(this.xData[n]).split(`
`),o=a.amount/(this.indentCharacter==="	"?4:1),h=l[0],d=this.indentCharacter.repeat(o<0?0:o),p=l.map(m=>d+m);return p[0]=h,`${p.join(`
`)}`})}restoreXInit(e){return i.default.replace(e,new RegExp(`${this.getXInitPlaceholder("(\\d+)")}`,"gm"),(t,n)=>{var u;let r=this.getXInitPlaceholder(n.toString()),s=(u=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?u:[""],a=(0,w.default)(s[0]),l=this.formatJS(this.xInit[n]).split(`
`),o=a.amount/(this.indentCharacter==="	"?4:1),h=l[0],d=this.indentCharacter.repeat(o<0?0:o),p=l.map(m=>d+m);return p[0]=h,`${p.join(`
`)}`})}restoreTemplatingString(e){return i.default.replace(e,new RegExp(`${this.getTemplatingStringPlaceholder("(\\d+)")}`,"gms"),(t,n)=>this.templatingStrings[n])}restoreStringLiteralInPhp(e){return i.default.replace(e,new RegExp(`${this.getStringLiteralInPhpPlaceholder("(\\d+)")}`,"gms"),(t,n)=>this.stringLiteralInPhp[n])}restoreComponentAttribute(e){return i.default.replace(e,new RegExp(`${this.getComponentAttributePlaceholder("(\\d+)")}`,"gim"),(t,n)=>{var h;let r=this.getComponentAttributePlaceholder(n),s=(h=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?h:[""],a=(0,w.default)(s[0]),l=this.componentAttributes[n],o=i.default.replace(l,/(:{1,2}.*?=)(["'])(.*?)(?=\2)/gis,(d,p,u,m)=>{if(m==="")return d;if(p.startsWith("::"))return`${p}${u}${R.default.js_beautify(m,{wrap_line_length:this.wrapLineLength-a.amount,brace_style:"preserve-inline"}).trim()}`;if(this.isInline(m))try{return`${p}${u}${B(m,{...this.defaultPhpFormatOption,printWidth:this.wrapLineLength-a.amount}).trimEnd()}`}catch{return`${p}${u}${m}`}return`${p}${u}${B(m,{...this.defaultPhpFormatOption,printWidth:this.wrapLineLength-a.amount}).trimEnd()}`});return`${this.indentComponentAttribute(a.indent,o)}`})}restoreShorthandBinding(e){return i.default.replace(e,new RegExp(`${this.getShorthandBindingPlaceholder("(\\d+)")}`,"gms"),(t,n)=>{var h;let r=this.getShorthandBindingPlaceholder(n),s=(h=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?h:[""],a=(0,w.default)(s[0]),l=this.shorthandBindings[n],o=i.default.replace(l,/(:{1,2}.*?=)(["'])(.*?)(?=\2)/gis,(d,p,u,m)=>{let b={wrap_line_length:this.wrapLineLength-a.amount,brace_style:"preserve-inline"};if(m==="")return d;if(this.isInline(m))try{return`${p}${u}${R.default.js_beautify(m,b).trimEnd()}`}catch{return`${p}${u}${m}`}return`${p}${u}${R.default.js_beautify(m,b).trimEnd()}`});return`${this.indentComponentAttribute(a.indent,o)}`})}async formatAsBlade(e){this.currentIndentLevel=0,this.shouldBeIndent=!1;let t=N(e),n=await new q(this.vsctm,this.oniguruma);return n.createRegistry(e).loadGrammar("text.html.php.blade").then(a=>n.tokenizeLines(t,a)).then(a=>this.formatTokenizedLines(t,a)).catch(a=>{throw a})}formatTokenizedLines(e,t){this.result=[],this.stack=[];for(let n=0;n<e.length;n+=1){let r=e[n],s=t[n];this.processLine(s,r)}return this.result.join(this.endOfLine)}processLine(e,t){this.processTokenizeResult(e,t)}processKeyword(e){if(i.default.includes(O,e)){i.default.last(this.stack)==="@case"&&e==="@case"&&this.decrementIndentLevel(),e==="@case"&&(this.shouldBeIndent=!0),this.stack.push(e);return}if(i.default.includes(M,e)){if(e==="@break"){this.decrementIndentLevel(),this.stack.pop(),this.stack.push(e);return}if(i.default.last(this.stack)!=="@hassection"){this.stack.pop();return}}if(i.default.includes(de,e)&&(this.shouldBeIndent=!0,this.stack.push(e)),i.default.includes(ne,e)&&i.default.includes(pe,i.default.last(this.stack))&&(this.decrementIndentLevel(),this.shouldBeIndent=!0),i.default.includes(C,e)&&(i.default.last(this.stack)==="@section"&&e==="@section"?(this.currentIndentLevel>0&&this.decrementIndentLevel(),this.shouldBeIndent=!0,this.stack.push(e)):(this.shouldBeIndent=!0,this.stack.push(e))),i.default.includes(E,e)){if(e==="@endswitch"&&i.default.last(this.stack)==="@default"){this.decrementIndentLevel(2),this.shouldBeIndent=!1;return}this.decrementIndentLevel(),this.shouldBeIndent=!1,this.stack.pop()}i.default.includes(L,e)&&(this.decrementIndentLevel(),this.shouldBeIndent=!0)}processToken(e,t){if(i.default.includes(e.scopes,"punctuation.definition.comment.begin.blade")&&(this.isInsideCommentBlock=!0),this.argumentCheck){let{count:n,inString:r,stack:s}=this.argumentCheck;if(!r&&t===")"){if(s.push(t),n[t]+=1,n["("]===n[t]){let a=s.join("");we(a)>=this.argumentCheck.unindentOn&&(this.shouldBeIndent=!1),this.argumentCheck=!1}return}s.push(t),r===t?this.argumentCheck.inString=!1:!r&&(t==='"'||t==="'")&&(this.argumentCheck.inString=t),t==="("&&!r&&(n[t]+=1)}i.default.includes(e.scopes,"punctuation.definition.comment.end.blade")&&(this.isInsideCommentBlock=!1),(t==="{{--"||t.includes("{{--"))&&(this.isInsideCommentBlock=!0),(t==="--}}"||t.includes("--}}"))&&(this.isInsideCommentBlock=!1),i.default.includes(e.scopes,"keyword.blade")&&(this.isInsideCommentBlock||(this.processKeyword(t.toLowerCase()),i.default.includes(Object.keys(te),t.toLowerCase())&&(this.argumentCheck={unindentOn:te[t.toLowerCase()],stack:[],inString:!1,count:{"(":0,")":0}})))}processTokenizeResult(e,t){if(this.shouldBeIndent&&(this.incrementIndentLevel(),this.shouldBeIndent=!1),ge(e,t)){this.insertFormattedLineToResult(t);return}for(let n=0;n<e.tokens.length;n+=1){let r=e.tokens[n],s=t.substring(r.startIndex,r.endIndex).trim();this.processToken(r,s)}this.insertFormattedLineToResult(t)}insertFormattedLineToResult(e){let n=(0,w.default)(e).amount+this.indentSize*this.currentIndentLevel,r=this.indentCharacter.repeat(n<0?0:n)+e.trim();e.length===0&&this.result.push(e),e.length!==0&&r.length>0&&this.result.push(r),r!==e&&this.diffs.push({original:e,formatted:r})}incrementIndentLevel(e=1){this.currentIndentLevel+=e}decrementIndentLevel(e=1){this.currentIndentLevel-=e}formatJS(e){let t=e,n={js:[],entangle:[]};return Object.keys(n).forEach(r=>{t=t.replace(new RegExp(`@${r}\\((?:[^)(]+|\\((?:[^)(]+|\\([^)(]*\\))*\\))*\\)`,"gs"),s=>{let a=n[r].push(s)-1;return this.getPlaceholder(r,a,s.length)})}),t=R.default.js_beautify(t,{brace_style:"preserve-inline"}),Object.keys(n).forEach(r=>{t=t.replace(new RegExp(this.getPlaceholder(r,"_*(\\d+)"),"gms"),(s,a)=>n[r][a])}),t}};var ke=f(require("path")),Te=f(require("fs")),Oe=f(require("ajv")),je=f(require("find-config")),st=new Oe.default,Ae=[".bladeformatterrc.json",".bladeformatterrc"];function We(c){for(let e=0;e<Ae.length;e+=1){let t=(0,je.default)(Ae[e],{cwd:ke.default.dirname(c),home:!1});if(t)return t}return null}async function ze(c){if(c===null)return;let e=JSON.parse((await Te.default.promises.readFile(c)).toString()),t={type:"object",properties:{indentSize:{type:"integer",nullable:!0},wrapLineLength:{type:"integer",nullable:!0},wrapAttributes:{type:"string",enum:["auto","force","force-aligned","force-expand-multiline","aligned-multiple","preserve","preserve-aligned"],nullable:!0},endWithNewline:{type:"boolean",nullable:!0},endOfLine:{type:"string",enum:["LF","CRLF"],nullable:!0},useTabs:{type:"boolean",nullable:!0},sortTailwindcssClasses:{type:"boolean",nullable:!0},tailwindcssConfigPath:{type:"string",nullable:!0},sortHtmlAttributes:{type:"string",enum:["none","alphabetical","code-guide","idiomatic","vuejs","custom"],nullable:!0},customHtmlAttributesOrder:{type:"array",nullable:!0,items:{type:"string"},default:[]},noMultipleEmptyLines:{type:"boolean",nullable:!0},noPhpSyntaxCheck:{type:"boolean",nullable:!0}},additionalProperties:!0},n=st.compile(t);if(!n(e))throw n;return e}var J=class extends Error{};var X=class{constructor(e={},t=[]){var n;this.currentTargetPath=".",this.paths=t,this.options=e,this.targetFiles=[],this.errors=[],this.diffs=[],this.outputs=[],this.formattedFiles=[],this.ignoreFile="",this.fulFillFiles=[],this.targetFiles=[],this.runtimeConfigPath=(n=e.runtimeConfigPath)!=null?n:null,this.runtimeConfigCache={}}async format(e,t={}){this.options=this.options||t;let n=I.default.resolve(g.default.cwd(),"target");return await this.readIgnoreFile(n),await this.findTailwindConfig(n),await this.readRuntimeConfig(n),new k(this.options).formatContent(e).catch(r=>{throw new J(r)})}async formatFromCLI(){try{this.printPreamble(),await this.readIgnoreFile(g.default.cwd()),await this.processPaths(),this.printResults()}catch{}}fileExists(e){return W.default.promises.access(e,W.default.constants.F_OK).then(()=>!0).catch(()=>!1)}async readIgnoreFile(e){let t=".bladeignore",n,r=I.default.dirname(e);if(this.options.ignoreFilePath?n=this.options.ignoreFilePath:n=(0,le.default)(t,{cwd:r}),!!n)try{this.ignoreFile=(await W.default.promises.readFile(n)).toString()}catch{}}async findTailwindConfig(e){if(!this.options.sortTailwindcssClasses)return;let t="tailwind.config.js",n;if(this.options.tailwindcssConfigPath)if(this.runtimeConfigPath){let r=I.default.dirname(this.runtimeConfigPath);n=I.default.resolve(r,this.options.tailwindcssConfigPath)}else I.default.isAbsolute(this.options.tailwindcssConfigPath)?n=I.default.resolve(this.options.tailwindcssConfigPath):n=I.default.resolve(this.options.tailwindcssConfigPath);else{let r=I.default.dirname(e);n=(0,le.default)(t,{cwd:r})}!n||(this.options.tailwindcssConfigPath=n)}async readRuntimeConfig(e){var n,r;P.default.isEmpty(this.runtimeConfigCache)&&(this.options=P.default.merge(this.options,this.runtimeConfigCache));let t;if(this.options.runtimeConfigPath?t=this.options.runtimeConfigPath:t=We(e),!P.default.isNull(t)){this.runtimeConfigPath=t;try{let s=await ze(t);this.options=P.default.merge(this.options,s),this.runtimeConfigCache=this.options,this.options.sortTailwindcssClasses&&await this.findTailwindConfig(e)}catch(s){s instanceof SyntaxError&&(g.default.stdout.write($.default.red.bold(`
Blade Formatter JSON Syntax Error: 

`)),g.default.stdout.write(oe.default.format(s)),g.default.exit(1)),g.default.stdout.write($.default.red.bold(`
Blade Formatter Config Error: ${I.default.basename(t)}

`)),g.default.stdout.write(`\`${s.errors[0].instancePath.replace("/","")}\` ${s.errors[0].message}

`),(n=s.errors[0].params)!=null&&n.allowedValues&&console.log((r=s.errors[0].params)==null?void 0:r.allowedValues),g.default.exit(1)}}}async processPaths(){await Promise.all(P.default.map(this.paths,async e=>this.processPath(e)))}async processPath(e){await X.globFiles(e).then(t=>P.default.map(t,n=>I.default.relative(".",n))).then(t=>this.filterFiles(t)).then(this.fulFillFiles).then(t=>this.formatFiles(t))}static globFiles(e){return new Promise((t,n)=>{(0,Ne.default)(e,(r,s)=>r?n(r):t(s))})}async filterFiles(e){if(this.ignoreFile==="")return e;let t=/^\.\.*/,n=P.default.filter(e,a=>t.test(I.default.relative(".",a))),r=P.default.xor(e,n),s=(0,He.default)().add(this.ignoreFile).filter(r);return P.default.concat(n,s)}static fulFillFiles(e){return this.targetFiles.push(e),Promise.resolve(e)}async formatFiles(e){await Promise.all(P.default.map(e,async t=>this.formatFile(t)))}async formatFile(e){await this.findTailwindConfig(e),await this.readRuntimeConfig(e),await Z(e).then(t=>Promise.resolve(t.toString("utf-8"))).then(t=>new k(this.options).formatContent(t)).then(t=>this.checkFormatted(e,t)).then(t=>this.writeToFile(e,t)).catch(t=>{this.handleError(e,t)})}async checkFormatted(e,t){this.printFormattedOutput(e,t);let n=W.default.readFileSync(e,"utf-8"),r=N(n),s=N(t),a=ve(e,r,s);return this.diffs.push(a),this.outputs.push(t),a.length>0&&((this.options.progress||this.options.write)&&g.default.stdout.write($.default.green("F")),this.options.checkFormatted&&(g.default.stdout.write(`${e}
`),g.default.exitCode=1),this.formattedFiles.push(e)),a.length===0&&(this.options.progress||this.options.write)&&g.default.stdout.write($.default.green(".")),Promise.resolve(t)}printFormattedOutput(e,t){this.options.write||this.options.checkFormatted||(g.default.stdout.write(`${t}`),P.default.last(this.paths)===e||P.default.last(this.targetFiles)===e)||(this.paths.length>1||this.targetFiles.length>1)&&g.default.stdout.write(`
`)}writeToFile(e,t){!this.options.write||this.options.checkFormatted||t.length===0||P.default.isNull(t)||P.default.isEmpty(t)||W.default.writeFile(e,t,n=>{n&&(g.default.stdout.write(`${$.default.red(n.message)}
`),g.default.exit(1))})}handleError(e,t){(this.options.progress||this.options.write)&&g.default.stdout.write($.default.red("E")),g.default.exitCode=1,this.errors.push({path:e,message:t.message,error:t})}printPreamble(){this.options.checkFormatted&&g.default.stdout.write(`Check formatting... 
`)}async printResults(){this.printDescription(),this.printDifferences(),this.printFormattedFiles(),this.printErrors()}printDescription(){if(!this.options.write)return;let e=`

`;g.default.stdout.write(e),g.default.stdout.write($.default.bold.green(`Fixed: F
`)),g.default.stdout.write($.default.bold.red(`Errors: E
`)),g.default.stdout.write($.default.bold("Not Changed: ")+$.default.bold.green(`.
`))}printFormattedFiles(){if(this.formattedFiles.length===0){this.options.checkFormatted&&g.default.stdout.write($.default.bold(`
All matched files are formatted! 
`));return}if(!this.options.write){this.options.checkFormatted&&g.default.stdout.write(`
Above file(s) are formattable. Forgot to run formatter? Use ${$.default.bold("--write")} option to overwrite.
`);return}g.default.stdout.write($.default.bold(`
Formatted Files: 
`)),P.default.each(this.formattedFiles,e=>g.default.stdout.write(`${$.default.bold(e)}
`))}printDifferences(){if(!!this.options.diff){if(g.default.stdout.write($.default.bold(`
Differences: 

`)),P.default.filter(this.diffs,e=>e.length>0).length===0){g.default.stdout.write((0,$.default)(`No changes found. 

`));return}P.default.each(this.diffs,e=>Pe(e))}}printErrors(){P.default.isEmpty(this.errors)||(g.default.stdout.write($.default.red.bold(`
Errors: 

`)),P.default.each(this.errors,e=>g.default.stdout.write(`${oe.default.format(e)}
`)))}};0&&(module.exports={BladeFormatter,Formatter});
//# sourceMappingURL=bundle.js.map
